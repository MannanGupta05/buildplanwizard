{% extends "base.html" %}

{% block title %}Analysis in Progress - Map Analysis System{% endblock %}

{% block content %}
<div class="container text-center mt-5">
    <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <h2 class="mt-4">Analysis in Progress...</h2>
    <p class="lead">Please wait while we analyze your map for compliance. This may take a few minutes.</p>
</div>
<script>
    // Poll the server every 3 seconds to check analysis status
    function checkStatus() {
        fetch("{{ url_for('check_analysis_status', map_id=map_id) }}")
            .then(response => response.json())
            .then(data => {
                if (data.analysis_completed) {
                    window.location.href = "{{ url_for('check_map') }}";
                } else {
                    setTimeout(checkStatus, 3000);
                }
            })
            .catch(() => setTimeout(checkStatus, 3000));
    }
    checkStatus();
</script>
{% endblock %}
