<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Map Analysis System{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --primary-dark: #764ba2;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            margin: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background Particles */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120,119,198,0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120,119,198,0.2) 0%, transparent 50%);
            animation: backgroundFloat 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundFloat {
            0%,100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }

        /* Navbar */
        .navbar {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            position: relative;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none !important;
        }

        .navbar-brand i {
            margin-right: 0.5rem;
        }

        .navbar-nav .nav-link {
            color: var(--text-primary) !important;
            font-weight: 500;
            margin: 0 0.25rem;
            padding: 0.5rem 1rem !important;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .navbar-nav .nav-link:hover {
            background: var(--primary-gradient);
            color: #fff !important;
            transform: translateY(-1px);
        }

        /* Floating Particles */
        .floating-particles {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        .particle {
            position: absolute;
            width: 4px; height: 4px;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }
        .particle:nth-child(1){ left:10%; animation-delay:0s; }
        .particle:nth-child(2){ left:20%; animation-delay:2s; }
        .particle:nth-child(3){ left:70%; animation-delay:4s; }
        .particle:nth-child(4){ left:90%; animation-delay:6s; }

        @keyframes float {
            0%,100%{ transform: translateY(100vh) scale(0); opacity:0; }
            10%{ transform: translateY(90vh) scale(1); opacity:1; }
            90%{ transform: translateY(10vh) scale(1); opacity:1; }
        }

        /* Container */
        .container { position: relative; z-index: 1; }

        /* Cards */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); box-shadow:0 30px 60px rgba(0,0,0,0.1); }
        .card-header { background: transparent; border-bottom:1px solid rgba(255,255,255,0.1); padding:1rem 1.5rem; border-radius: 20px 20px 0 0; }

        /* Buttons */
        .btn {
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn-primary {
            background: var(--primary-gradient);
            color: #fff;
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 35px rgba(102,126,234,0.4); }
        .btn-secondary { background: rgba(107,114,128,0.1); color: var(--text-primary); }
        .btn-secondary:hover { background: rgba(107,114,128,0.2); transform: translateY(-1px); }

        /* Ripple effect */
        .btn::before {
            content: ''; position: absolute; top:0; left:-100%;
            width:100%; height:100%; background: rgba(255,255,255,0.2);
            transition: left 0.5s ease;
        }
        .btn:hover::before { left:100%; }

        /* Alerts */
        .alert { border-radius: 16px; padding: 1rem 1.5rem; border:1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); box-shadow:0 12px 32px rgba(0,0,0,0.08); }
        .alert-success { background-color:#d1fae5; color:#065f46; }
        .alert-danger { background: rgba(239,68,68,0.1); color:#dc2626; }
        .alert-warning { background: rgba(245,158,11,0.1); color:#d97706; }
        .alert-info { background: rgba(59,130,246,0.1); color:#2563eb; }

        /* Forms */
        .form-control {
            border-radius: 12px;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .form-control:focus { border-color: var(--primary-color); background: rgba(255,255,255,0.2); box-shadow:0 0 0 4px rgba(102,126,234,0.1); }
        .form-control::placeholder { color: var(--text-secondary); }

        @media (max-width:768px){
            .navbar-brand { font-size:1.25rem; }
            .card-body { padding:1.5rem; }
            .card-header { padding:1rem 1.5rem; }
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Floating Particles -->
    <div class="floating-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('home') }}">
                <i class="fas fa-map-marked-alt"></i> Map Analysis System
            </a>
            {% if session.user_id %}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><span class="navbar-text me-3">Welcome, {{ session.full_name }}!</span></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('upload_map') }}">Upload Map</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('history') }}">History</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('all_feedback') }}"><i class="fas fa-comments"></i> Feedback</a></li>
                </ul>
            </div>
            {% endif %}
        </div>
    </nav>

    <div class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{% if category=='error' %}danger{% elif category=='success' %}success{% elif category=='info' %}info{% else %}warning{% endif %} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Button ripple effect
            document.querySelectorAll('.btn').forEach(button=>{
                button.addEventListener('click', function(e){
                    const ripple=document.createElement('div');
                    const rect=this.getBoundingClientRect();
                    const size=Math.max(rect.width, rect.height);
                    const x=e.clientX-rect.left-size/2;
                    const y=e.clientY-rect.top-size/2;
                    ripple.style.cssText=`position:absolute;border-radius:50%;background:rgba(255,255,255,0.3);transform:scale(0);animation:ripple 0.6s linear;left:${x}px;top:${y}px;width:${size}px;height:${size}px;pointer-events:none;`;
                    this.appendChild(ripple);
                    setTimeout(()=>ripple.remove(),600);
                });
            });
        });

        if(!document.querySelector('#ripple-styles')){
            const style=document.createElement('style');
            style.id='ripple-styles';
            style.textContent=`@keyframes ripple{to{transform:scale(4);opacity:0;}}`;
            document.head.appendChild(style);
        }
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
